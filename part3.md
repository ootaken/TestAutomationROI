# ROIの試算式の詳細と実際

今回はROIの試算式の詳細を解説し、実際にこの試算式でスモークテストとGUIテストの自動化のROIを求めてみます。

## 試算式の構成要素の詳細な解説

前回で Cost Benefits Analysis of Test Automation の以下の試算式を紹介しました。

ROI(t) = Δ手動テストに対するテスト自動化の利益 / Δ手動テスト対するテスト自動化のコスト = ΔB(t) / ΔC(t)

ΔB(t) = Σ(自動テストによる固定費の改善)(t) + Σ(n2回手動テストを実施した場合の変動費)(t) - Σ(n1回自動テストを実施した場合の変動費)(t)

ΔC(t) = Σ(自動テストによる固定費の増加)(t) + Σ(自動テストの開発費) - Σ(手動テストの開発費) + Σ(自動テストのメンテナンスコスト) (n1/N)

n1 = 自動テストの実行回数

n2 = 手動テストの実行回数

N = メンテナンスが必要になるまでの自動テストの平均実行回数

各要素を順に見ていきましょう。

「自動テストによる固定費の改善」とはテストの実行回数に依存しないテスト計画やテスト設計など、手動テストと自動テストで共通に発生するコストで改善された差分です。逆に自動テストを考慮した精緻化したテスト設計が必要になり追加コストが必要になりマイナスになる場合もあります。

手動テストと自動テストで実行回数を n2 と n1 で分けているのは通常、自動テストの実行の方が1回あたりのコストとかかる実行時間が短く、実行頻度が異なるためです。手動テストの場合は実行コストが高いため、テスト対象アプリケーションのビルド毎にテストを実行するのは難しいですが、自動テストの場合、実行コストが低いため、頻度を上げて素早く、障害を検出することができます。ただし、注意しなければならないのは N のメンテナンスが必要になるまでの自動テストの平均実行回数です。自動テストのテストレベルやテストタイプにもよりますが、対象アプリケーションのGUIやロジックの変化により、テストスクリプトの修正が必要になるため、最悪 N = 1 の自動テストの実行毎にメンテナンスコストが発生する場合があります。テストスクリプトの構造化、データ駆動化、オブジェクトマップやページオブジェクトによるGUI要素の抽象化などによってメンテナンスコストを下げると共に最適な N を検討する必要があります。

「自動テストによる固定費の増加」はテストツールのライセンスやサポートなど手動テストでは発生しない自動テストを導入した場合のコストです。ライセンス期間やアップグレードのコストがあるため、時間 t の関数になります。

「手動テストの開発費」は手動テストを続けた場合にかかっていたであろうコストでこれをマイナスすることにより、手動テストに対する自動テストの相対的な初期投資を算出しています。

第2回で解説したように固定費と変動費は更に詳細な要素に分解することもできますが、詳細に分解しない合算値からでもある程度妥当性があるものが出せると  Cost Benefits Analysis of Test Automation では述べています。筆者もまずは手動テストの単価計算に基づいた概算でも良いので算出できる要素から ROI を試算し、複数の施策を比較検討するのをお勧めします。

## スモークテストの自動化でのROIの試算

先ほどの式を使って、以下のような仮定でスモークテスト(ビルド後にその後のテストに進むべきかを判断にするのに使われる最小限セットのテスト)の ROI を求めてみましょう。

* 1日に1回ビルドを実施し、テストを実行します (週に5回)
* 手動テストでは設計に5日、実行に2時間かかります
* 手動テストは半分のみを1日1時間で実行し、残り半分を次の日に1時間実行します (ビルド毎には半分しか実行しません)
* 自動テストは設計と実装に15日かかり、実行は自動であるため、コストゼロとします
* 自動テストには10万円の追加ハードウェアが必要で、減価償却期間は3年とします
* 自動テストは25回の実行に1回、1日のメンテナンスが必要です
* 試算対象期間 t としては6ヶ月(125日)と18ヶ月(375日)を選びます
* 手動テスト、自動テストのいずれのエンジニアの単価も80万円/月、960万円/年、4万円/日、5,000円/時とします

ΔB(t) = Σ(自動テストによる固定費の改善)(t) + Σ(n2回手動テストを実施した場合の変動費)(t) - Σ(n1回自動テストを実施した場合の変動費)(t)

ΔB(6ヶ月) = 0 + (1時間 * 125) - (0 * 125) = 5,000 * 125 = 625,000 (円)

ΔB(18ヶ月) = 0 + (1時間 * 375) - (0 * 375) = 5,000 * 375 = 1,875,000円 (円)


ΔC(t) = Σ(自動テストによる固定費の増加)(t) + Σ(自動テストの開発費) - Σ(手動テストの開発費) + Σ(自動テストのメンテナンスコスト) (n1/N)

ΔC(6ヶ月) = 100,000 * (6/36) + 15 * 40,000 - (5 * 40,000) + 40,000 * (125/25) = 616,666 (円)

ΔC(18ヶ月) = 100,000 * (18/36) + 15 * 40,000 - (5 * 40,000) + 40,000 * (375/25) = 1,050,000 (円)

ROI(6ヶ月) = 625,000 / 616,666 =  1.013 (損益分岐点)

ROI(18ヶ月) = 1,875,000 / 1,050,000 = 1.786 (80%リターン)

手動テストの実行を外注していると仮定し、以下のように条件を変更して再度 ROI を求めてみましょう。

* 手動テストの設計と自動テスト設計・実装のエンジニアの単価は80万円/月、960万円/年、4万円/日、5,000円/時のままとします
* 手動テストの実行エンジニアの単価を40万円/月、480万円/年、2万円/日、2,500円/時に変更します
* 試算対象期間 t としては36ヶ月(750日)を追加します

ΔB(6ヶ月) = 0 + (1時間 * 125) - (0 * 125) = 2,500 * 125 = 312,500 (円)

ΔB(18ヶ月) = 0 + (1時間 * 375) - (0 * 375) = 2,500 * 375 = 937,500円 (円)

ΔB(36ヶ月) = 0 + (1時間 * 750) - (0 * 375) = 2,500 * 750 = 1,875,500円 (円)

ΔC(6ヶ月) = 100,000 * (6/36) + 15 * 40,000 - (5 * 40,000) + 40,000 * (125/25) = 616,666 (円)

ΔC(18ヶ月) = 100,000 * (18/36) + 15 * 40,000 - (5 * 40,000) + 40,000 * (375/25) = 1,050,000 (円)

ΔC(36ヶ月) = 100,000 * (36/36) + 15 * 40,000 - (5 * 40,000) + 40,000 * (750/25) = 1,700,000 (円)

ROI(6ヶ月) = 312,500 / 616,666 = 0.507 (投資期間)

ROI(18ヶ月) = 937,500 / 1,050,000 = 0.89 (損益分岐点に達しない)

ROI(36ヶ月) = 1,875,500 / 1,700,000 = 1.103 (10%リターン)

手動テストの実行コストが低い場合、自動化をしても、3年でようやく10%リターンとなります。

日本でなかなかテスト自動化が進まない理由のうちの一つとして、自動テストが適用可能な領域が限られていること以外にも、手動テストの実行が単価の安いエンジニアでも可能な一方テスト自動化には単価の高いエンジニアが必要で、直近を見た場合、 ROI が悪いというのも理由の一つである事が実際に試算してみると分かります。一方エンジニアのコストが高いアメリカでは実行コストを下げるために、オフショアと自動テストの ROI 投資効率比較をして結果として国内でのテスト自動化が選ばれると考えられます。

第2回で解説した Risk Reduction ROI Method のように欠陥対応コストを盛り込めば、ROI の試算値は向上しますが、実測値と大きく乖離する場合があるので注意しましょう。

## GUIテストの自動化でのROIの試算

次に下記の条件で GUI テストの自動化の ROI を求めてみましょう。

* 新規のソフトウェアでテストも一から作成します
* 手動テストの開発には5人/年、自動テストの開発には15人/年かかります
* 自動テストでは1年後に1人/年のメンテナンスが発生します
* 手動テストの実行では10人/年のフルタイムのメンバーが、自動テストでは1人/年のメンバーが必要です
* 自動テストには900万円の固定費が減価償却3年で必要です
* 試算対象期間 t としては12ヶ月(250日)と24ヶ月(500日)を選びます
* 手動テスト、自動テストのいずれのエンジニアの単価も80万円/月、960万円/年、4万円/日、5,000円/時とします

ΔB(t) = Σ(自動テストによる固定費の改善)(t) + Σ(n2回手動テストを実施した場合の変動費)(t) - Σ(n1回自動テストを実施した場合の変動費)(t)

ΔB(12ヶ月) = 0 + (10人 * 9,600,000)  - (1人 * 9,600,000) = 86,400,000　(円)

ΔB(24ヶ月) = 0 + (10人 * 9,600,000 * 2)  - (1人 * 9,600,000 * 2) = 172,800,000 (円)

ΔC(t) = Σ(自動テストによる固定費の増加)(t) + Σ(自動テストの開発費) - Σ(手動テストの開発費) + Σ(自動テストのメンテナンスコスト) (n1/N)

ΔC(12ヶ月) = (9,000,000 * (1/3)) + (15 * 9,600,000) - (5 * 9,600,000) + 0 = 99,000,000 (円)

ΔC(24ヶ月) = (9,000,000 * (2/3)) + (15 * 9,600,000) - (5 * 9,600,000) + 9,600,000 = 111,600,000 (円)

ROI(12ヶ月) = 86,400,000 / 99,000,000 = 0.873 (損益分岐点に達しない)

ROI(24ヶ月) = 172,800,000 / 111,600,000 = 1.548 (55%リターン)

スモークテストの時と同じように手動テストは外注し、かつ、自動テストツールはオープンソースの無料ツールを使用するという条件に変更して ROI を求めてみましょう。

* 手動テストの設計のエンジニアの単価は80万円/月、960万円/年、4万円/日、5,000円/時のままとします
* スモークテストの時よりも自動テストの設計･実装に高いスキルが必要になると仮定し、自動テストのエンジニアの単価は100万円/月、1200万円/年、5万円/日、6250円/時に変更します
* スモークテストの時よりも手動テストの実行と分析、報告に高いスキルが必要になると仮定し、手動テストの実行エンジニアの単価を60万円/月、720万円/年、3万円/日、3750円/時に変更します
* 自動テストではオープンソースの無料ツールを使い、ソフトウェアのコストはかからないように変更します。ただし、商用ツールと同等の機能を一部作り込む必要があり、そのコスト上昇分は自動テストのエンジニアの単価上昇に含まれています
* 自動テストには実行ハードウェア分の90万円の固定費が減価償却3年で必要です
* 試算対象期間 t としては36ヶ月(750日)を追加します

ΔB(12ヶ月) = 0 + (10人 * 7,200,000)  - (1人 * 9,600,000) = 62,400,000 (円)

ΔB(24ヶ月) = 0 + (10人 * 7,200,000 * 2)  - (1人 * 9,600,000 * 2) = 124,800,000 (円)

ΔB(36ヶ月) = 0 + (10人 * 7,200,000 * 3)  - (1人 * 9,600,000 * 3) = 187,200,000 (円)

ΔC(12ヶ月) = (900,000 * (1/3)) + (15 * 120,000,000) - (5 * 9,600,000) + 0 = 132,300,000 (円)

ΔC(24ヶ月) = (900,000 * (2/3)) + (15 * 120,000,000) - (5 * 9,600,000) + 9,600,000 = 142,200,000 (円)

ΔC(36ヶ月) = (900,000 * (3/3)) + (15 * 120,000,000) - (5 * 9,600,000) + 9,600,000 = 142,500,000 (円)

ROI(12ヶ月) = 62,400,000 / 132300,000 = 0.472 (投資期間)

ROI(24ヶ月) = 124,800,000 / 142,200,000 = 0.878 (損益分岐点に達しない)

ROI(36ヶ月) = 187,200,000 / 142,500,000 = 1.317 (32%リターン)

この条件ではスモークテストよりテストレベルが上がるため、手動テストの実行エンジニアの単価を上げると同時に、自動テストの設計、実装も難易度が上がると仮定し、自動テストのエンジニアの単価も上げました。自動テストエンジニアコスト上昇分を打ち消すためにオープンソースを採用し、ツールのコストを削減しましたが、エンジニアの単価上昇分を打ち消すまでには至っておらず、却って作り込みのスキルに必要な分エンジニアの単価は上昇し、結果として損益分岐点は最初の例よりも遅れてしまいました。

この例からも特に人件費の高い先進国ではツールやハードウェアのコストよりも人件費が ROI に大きく影響を与えることが分かると思います。逆にツールやハードウェアへの投資が人件費の削減に繋がるのでしたら積極的に投資した方が ROI が高まるともいえます。

# まとめ

本連載では テスト自動化で ROI を試算する理由から、テスト自動化の ROI の構成要素と複数の試算式、そして試算の実際を解説してきました。テスト自動化に限らず、ソフトウェア開発では様々な外部要素や変動要素が絡むため、精確な ROI を求めるのは難しいですが、今回の試算の例でも分かるように簡易的な試算であれば最小限の構成要素から試算することができます。テスト自動化の提案や企画の際の定量的な交渉条件として、本連載で学んだ様々な ROI の試算式を読者の皆様が活用してくれることを楽しみにしています。
