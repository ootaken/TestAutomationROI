# 試算式の構成要素と試算式の例

第1回でテスト自動化のROIは下記のようにして求められることを解説しました。

ROI(t) = (手動テストを続けた場合の運用コスト(t) - 自動テストの運用コスト(t)) / (自動テストの初期開発コスト + 自動テストの運用コスト(t))

第2回では各コストを分解した構成要素とその構成要素を使った試算式を解説します。

## テスト自動化のROIの試算式の構成要素

まず、ROIの試算式の構成要素について、The Return on Investment (ROI) of Test Automation ( http://www.arcondis.com/assets/files/pdf/publikationen/ROI%20of%20Test%20Automation.pdf ) と Cost Benefits Analysis of Test Automation ( http://www.softwarequalitymethods.com/papers/star99%20model%20paper.pdf )の解説例を見ていきます。

### The Return on Investment (ROI) of Test Automationで解説している構成要素

The Return on Investment (ROI) of Test Automation ではROIの構成要素として下記を挙げています。

要素|説明|手動テストの運用コスト|自動テストの開発コスト|自動テストの運用コスト|テストで直接的に発生するコスト|テストで間接的に発生するコスト
----|----|------|------|------|----|----
テストケース数|実行する総テストケース数(手動、自動両方)|○||○|○|
自動化対象のテストケース数|自動化を予定しているテストケース数||○|○|○|
サイクルあたりの実行テストケース数|各サイクルで実行するテストケース数|○||○|○|
テストサイクル数|ROIの評価対象期間でのテストサイクル数(週毎、ビルド毎、リリース毎など)|○||○|○|
テストエンジニアの時間単価|テストエンジニアの平均時間単価|○|||○|
欠陥コスト|本番環境での欠陥に対する予想対応コスト|○||○||○
手動テストの実行・分析時間|1つの手動テストの実行と結果の分析にかかる平均時間|○|||○|
ツールの取得、検証、ライセンスコスト|テストツールにかかるコスト||○||○|
ツールのトレーニングコスト|ツールの習得に必要なトレーニングコスト||○||○|
テスト実行マシンのコスト|手動テスト環境とは分離した自動テスト用のマシン環境のコスト||○|○|○|
自動テスト環境の構築コスト|自動テストの環境が使用できるまでのコスト||○||○|
自動テストの開発時間|テストスクリプトの開発に必要な時間||○|○|○|
自動テストの実行時間|自動テスト1ケースあたりの平均実行時間|||○|○|
自動テストの結果分析時間|1サイクルの自動テストの実行結果の平均分析時間|||○|○|
自動テストの平均メンテナンス時間|1サイクルの自動テストを実行するためにメンテナンスにかかる平均時間|||○|○|
夜間実行の実施|昼間だけでなく夜間にも実行するか？|||○|○|

手動テストと自動テストの開発コストと運用コストは各単位時間あたりのコストと実行時間を積み上げていけば算出できます。

間接的に発生する欠陥コストについては、発生する欠陥の頻度、重要度によって異なり、自動化された後の値は同一の規模や特性を持ったソフトウェアからのベンチマークになるため、精確な予想値を求めるのが困難な場合があります。このため、簡易的なテストの運用改善に完結したROIの試算では使用しない場合もあります。

また、後述の複数の試算式で解説しますが、手動テストを自動化する場合に、手動テストが外注でそのまま自動化して置き換えるというようなシナリオを除くと、手動テストの人員は別のアプリケーションのテストや異なったテストタイプを担当して固定費としてはそのまま存続することがあります。この場合、テスト自動化対象のアプリケーション単独では手動テストと自動テストのコストからROIを算出できますが、テスト部門として考えた場合、欠陥コストのような間接コストを考慮しないとテスト部門としてのコスト改善はされていない可能性があります。このため、組織やチームの構成に応じて後述の試算式を使い分けてコストを積み上げる必要があります。

### Cost Benefits Analysis of Test Automationで解説している要素

Cost Benefits Analysis of Test Automation では、自動テストのコストの分類をテストの実行回数に依存しない固定費と実行回数の関数になるコストに分類しています。ただし、固定費と言っても、ROIの評価対象期間である時間tには依存します。例えば、(一括もしくは減価償却費とする)自動テストツールの取得コストやライセンス更新コスト、サポートコストなどは時間 t に依存します。

* 固定費
 - ハードウェア (追加及びアップグレードも含む)
 - 自動テストで使用するソフトウェア(テストウェア)のライセンス
 - テストウェア[^1]のサポートコスト
 - テストウェアの接続ライセンス
 - 自動テスト環境の設計と実装
 - 自動化環境のメンテナンス
 - 自動化スクリプト作成ツール
 - 自動テストツールと自動テスト環境のライセンス
 - ツールのトレーニング
 - ツールの導入とアップデート
* 実行回数に依存するコスト
 - 自動テストのためのテスト設計
 - 自動テストのテストケースの実装
 - 自動テストのメンテナンス
 - テストオラクル[^2]の作成
 - 自動テストの実行
 - テスト結果の分析
 - 障害報告
 - テスト実行の報告

実行回数に依存するコストは構成要素のタスク毎に厳密にコスト割り当てできている組織であれば、タスクのコストを積み上げることによって求められます。しかし、タスク毎に厳密にコスト割り当て出来ない場合、複数の施策の比較に同一の試算式を使うのならば、詳細に分解しない合算値からでもある程度妥当性があるものが出せるため、そのタスクに割り当てているエンジニアの人間単価の積み上げから始めても問題はありません。第3回の試算例でも人間単価の積み上げで計算します。

一方手動テストでも自動テストでも共通に実施する要素もあり、下記を挙げています。

* 共通要素
 - テスト対象の分析
 - テスト計画
 - 基本テスト設計
 - 手動テストも含めた障害報告
 - テスト結果のマネジメント向け報告

これらは自動テストの場合、手動テストより精緻化する必要があるため、自動テストに移行する際に一時的にはコストは上昇します。しかし、長期的には精緻化によって発生するプロセス改善効果によるコスト削減で相殺されることが多いため、ROIの試算には通常組み込まれません。ただし、実際にテスト自動化を開始すると手動のテストそのままを自動化することは少なく、上記の要素の精緻化に伴いテスト設計やテストケース実装の改善、テストカバレッジの増加が発生する可能性が高いため、自動化による実測値は試算値通りにならない可能性もあります。大きく試算値と実測値に乖離があった場合、自動化に伴い発生したテストプロセスの改善の存在を確認し、必要に応じて次のテスト自動化のROIの試算には要素として組み込むことを推奨します。但し、事前にこれらの要素の変化を精緻に見積もることは難しいため、最初はROIの試算に組み込まず、実測値を検証した後、必要に応じて次のテスト自動化のROIの試算から組み込んでいくのが良いでしょう。

手動テストと自動テストどちらも実施するが変化があるつまりコストが上昇もしくは低下する要素として下記を挙げています。

* テスト環境のメンテナンス (自動化によってトータルコストが上昇する場合もあります)
* テスト実行
* テスト結果の分析
* 障害報告
* テスト結果の報告
* テストデータの生成

テスト自動化で利益つまりコスト削減になるものとしては、下記を挙げています。

* テストの実行
* 業後のテスト実行

第3回ではこのCost Benefits Analysis of Test Automationで挙げられている要素を使いながら、ROIを試算していきます。

## 複数の試算式の紹介

ROIの試算式を構成する要素が分かりましたので、次は TABOK と Cost Benefits Analysis of Test Automation で解説している試算式のバリエーションを見ていきます。

### TABOK の3つの試算式

TABOK では Simple ROI Method, Efficiency ROI Method, Risk Reduction ROI Method という3つの試算式を紹介しています。

3つ試算式は Test Automation ROI ( http://www.dijohn-ic.com/test_automation_roi.pdf ) という記事でオープンになっていますので、この記事を参考にしながら解説していきます。

#### Simple ROI Method

Simple ROI Method は下記の式で表されます。分母に自動テストの初期開発コストも含んでいます。

ROI(t) = (手動テストを続けた場合の運用コスト(t) - 自動テストの初期開発コスト - 自動テストの運用コスト(t)) / (自動テストの初期開発コスト + 自動テストの運用コスト(t))

Simple ROI Method はコストの構成要素を金額で積み上げていくもので、下記の特徴を持ったテスト自動化で有効です。

* テストエンジニアの単価が明確になっている
* 自動化の投資期間が長い
* 既存の手動テストをテスト設計やカバレッジを変更せずにそのまま自動化する

Simple ROI Method のメリットとデメリットは下記の通りです。

* メリット
 - 金額ベースで積み上げていくためにROIの試算の内訳についてマネジメント層とコミュニケーションが取りやすい
* デメリット
 - テストエンジニアの単価が明確ではない場合、適用出来ない
 - 余りに計算を単純化しすぎている
  + 手動テストがそのままテスト設計やカバレッジを変更せずに自動テストに置き換わることは少ない
  + 自動化に伴う欠陥対策コストの減少、手動テストのカバレッジ増加などを無視している
 - テスト自動化によりプロジェクトの予算を圧縮できるように見える。通常は圧縮するのではなく、手動テストのカバレッジを広げたり、別のテストタイプのテストに再配分したりする

#### Efficiency ROI Method

Efficiency ROI Method は Simple ROI Method を改良したもので、金額の削減のみに注力してしまうことが多い Simple ROI Method に対して、金額ではなく、工数(時間や日数)をコストとして積み上げ、工数の改善効率をROIとします。

ROI(t) = (手動テストを続けた場合の運用工数(t) - 自動テストの初期開発工数 - 自動テストの運用工数(t)) / (自動テストの初期開発工数 + 自動テストの運用工数(t))

Efficiency ROI Method のメリットとデメリットは下記の通りです。

* メリット
 - 金額の削減のみに注力することを避けられる
 - テストエンジニアの単価が明確でなくても、適用出来る
* デメリット
 - 工数の削減のみに注力するために、 同一条件下では Simple ROI Method よりも ROI の値は低くなる
 - 金額とテストエンジニアの単価の問題以外は Simple ROI Method と同様の問題を抱える

#### Risk Reduction ROI Method

Risk Reduction ROI Method は テスト自動化により、テストの実行頻度とカバレッジ(自動と手動の両方)が増加した影響を加味するものです。これは間接コストつまり手動テストを実施していた場合の欠陥対応コストと、自動テストによる低減したコストの差分を盛り込んだものです。

ROI(t) = (欠陥コストの差分(t) + 手動テストを続けた場合の運用コスト(t) - 自動テストの初期開発コスト - 自動テストの運用コスト(t)) / (自動テストの初期開発コスト + 自動テストの運用コスト(t))

Risk Reduction ROI Method のメリットとデメリットは下記の通りです。

* メリット
 - 手動テストと自動テストの単純な開発・運用コスト比較ではないテスト自動化の効果をROIに盛り込める
* デメリット
 - 欠陥コストの低減を正確に見積もるのは難しい
 - テストカバレッジやテストタイプの増加は手動テストのままでも実施できるため、テスト自動化をROI向上の理由として訴求しにくくなる

## ROIとCBA

TABOK の3つのROIの試算式を見てきましたが、最後の Risk Reduction ROI Method で取り扱った間接コストについて考えてみましょう。製品あるいは本番サービスで発生した障害の対応コストについて、欠陥の修正コストについては、開発部門と(分離してれば)テスト部門が負うことになりますが、クレーム対応やリコール対応にかかるコストはカスタマーサポート部門、広報部門、営業部門などの複数に及ぶこともあります。このような自部門外で発生するコストを除外して自部門のROI改善のみに注力すると局所最適化になってしまう可能性があります。

また、内部と外部という考え方の他に、別の変動要素を考慮する必要があります。例えば、手動テスト、自動テストに限らず、同じメンバーで改善を進めていけば、1ケースあたりの設計コストや実装コストは下がっていくでしょう。また、逆にメンバーの入れ替えがあった場合には一時的にコストが上昇することもありえます。

このような外部への影響、変動要素などを考慮する場合、公共公益システムでの投資の試算に用いられるCBA ( Cost Benefit Analysis, 費用・便益分析 )[^3]の考え方が参考になります。CBA は国や地方公共団体が先導する公害対策 (水質改善や大気改善) のような企業が単純に自社のROIのみに注力してしまうと漏れてしまう外部性 (企業からはコストゼロに見える大気や水) に対してもコスト換算をした上で、利益と投資の範囲を企業単体からその企業の活動が影響を与える全ての範囲まで広げて、投資の是非を判断するものです。

また、CBA が対象とするプロジェクトは規模だけでなく、長期にわたるものが多いため、CBA を試算する際に不確実な将来の利益を現在の価値に割り引く、割引現在価値という概念を取り入れています。現在の低金利状態が続いている日本では割引現在価値まで考慮する必要は必ずしもありませんが、長期かつ広範囲なテスト自動化を検討する場合、CBAの時間経過の概念を踏まえて、ROIを試算することもできます。

通常、 CBA は国の規制や施策への投資の可否判断に対して用いられるものですが、欠陥コストの範囲を広げた場合の部門またぎのROIなどを検討する場合には有効な手法であるため、テスト自動化のROIを試算する場合に、CBAについて学び、考え方を利用してみるのも良いでしょう。

### Cost Benefits Analysis of Test Automation の2つの試算式

Cost Benefits Analysis of Test Automation では下記の2つの試算式を紹介しています。

1. ROI(t) = テスト自動化による利益 / テスト自動化のコスト
2. ROI(t) = Δ手動テストに対するテスト自動化の利益 / Δ手動テスト対するテスト自動化のコスト = ΔB(t) / ΔC(t)

Cost Benefits Analysis of Test Automation では1.の他と比較のないテスト自動化単独の利益とコストを精確に試算するのは難しいとしており、2.をブレークダウンして解説しています。

ΔB(t) = Σ(自動テストによる固定費の削減分)(t) + Σ(n2回手動テストを実施した場合の変動費)(t) - Σ(n1回自動テストを実施した場合の変動費)(t)

ΔC(t) = Σ(自動テストによる固定費の増加分)(t) + Σ(自動テストの開発費) - Σ(手動テストの開発費) + Σ(自動テストのメンテナンスコスト) (n1/N)

n1 = 自動テストの実行回数

n2 = 手動テストの実行回数

N = メンテナンスが必要になるまでの自動テストの平均実行回数

この式では時間軸と共に、テスト自動化による改善と増加コスト、自動テストと手動テストの実行頻度の違い、実行回数とは異なる頻度で発生する自動テストのメンテナンスコストが考慮されています。TABOK の Efficiency ROI Method を金額ベースにして精緻化したものと考えてよいでしょう。

# 次回予告

次回では Cost Benefits Analysis of Test Automation の上記の式の要素の詳細を解説するとともに、この式を使ってスモークテストとGUIテストの自動化のROIを実際に求めていきます。

[^1]:ソフトウェアテスト標準用語集 日本語版 Version 2.2.J03 ( http://jstqb.jp/dl/JSTQB-glossary.V2.2.J03.pdf ) テストウェア（testware）： テストプロセスを通じて作成される、テストの計画、設計、実行に不可欠なもの。たとえば、ドキュメント、スクリプト、入力、期待結果、セットアップとクリーンアップの処理手順、ファイル、データベース、環境、その他、テストで使用する付加的なソフトウェアやユーティリティなど。\[After Fewster and Graham\]
[^2]:ソフトウェアテスト標準用語集 日本語版 Version 2.2.J03 ( http://jstqb.jp/dl/JSTQB-glossary.V2.2.J03.pdf ) テストオラクル（test oracle）： テスト対象のソフトウェアの実行結果と比較する期待結果のソース。オラクルは、実在する（ベンチマーク用の）システム、他のソフトウェア、ユーザマニュアル、個人の専門知識の場合があるが、コードであってはならない。\[After Adrion\]
[^3]:電子政府政策における費用便益分析 ( http://www.iais.or.jp/ja/wp-content/uploads/2011/08/%E8%B2%BB%E7%94%A8%E4%BE%BF%E7%9B%8A%E5%88%86%E6%9E%90.pdf )
